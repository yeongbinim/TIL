# DTO 변환은 어디서 해야할까

기존 코드에서는 서비스 계층에서 presentation 계층으로 데이터를 전달할 때 엔티티를 ResponseDTO로 변환하고 있었다.

<img width="1200" src="https://github.com/user-attachments/assets/d97ec00d-bd32-412f-bd6d-998f09c436d3" />

이 부분이 살짝 어색했던 이유는 그동안 나는 Controller에서 entity -> dto로 변환해 왔었기 때문이다.

1. ResponseDTO의 목적은 **클라이언트에게 특정 데이터만 필터링 해서 반환**하기 위해서라고 생각했다.
2. 서비스 계층은 순전히 비즈니스 로직만 있는 것이 유지보수 관점에서 더 좋다고 생각했다.
3. 여러 종류의 컨트롤러에서 해당 서비스를 사용할 경우를 대비해 **하나의 응답DTO로 굳혀지면 안된다**고 생각했다.

이런 이유로 나는 컨트롤러에서 변환을 했고, 정팩메를 더해서 아래와 같이 변경했다.

<br/>

<img width="1200" alt="스크린샷 2025-01-06 오후 2 30 15" src="https://github.com/user-attachments/assets/6a093ecd-f11a-4249-891f-1b4319666f02" />

막상 작성하고 보니 아래의 부분이 찝찝했다.

1. controller에까지 entity 접근이 허용되어서 entity 변경의 위험이 있다.
2. 여러 **entity들의 정보를 조합해서 DTO를 생성해야 하는 경우**, Controller에서 이것을 처리하기 위해 여러 Service에 의존해야 하는가?

나만 이런 고민을 하지는 않았을 것 같아서 찾아보니 테코블에서 잘 정리해서 작성해놓은 글을 발견할 수 있었다.

[테코블: DTO의 사용 범위에 대하여](https://tecoble.techcourse.co.kr/post/2021-04-25-dto-layer-scope/)

서비스 계층에서 도메인을 보호하는 역할이 있기 때문에, RequestDto도 ResponseDto도 그 변환이 서비스 계층에서 이루어지는게 이상적인 것 같다는 접근이다.

하지만 결국 답은 정해져 있지 않고, 결국 프로젝트 규모와 아키텍쳐의 방향등을 종합적으로 고려해서 고민할 문제라고 한다.

<br/>

역시 결국엔 다 트레이드 오프를 생각해야하는구나..

레이어별로 DTO를 새로 둔다거나.. 헥사고날 아키텍처로 어찌저찌 하면 많은 부분들이 해결 되겠지만 프로그램의 복잡성이 올라가게 된다.

<br/>

결국 내린 결론은 현재 상태에서는 service 계층에서 DTO를 반환하는 것이 가장 나을 것 같다는 생각이다.

